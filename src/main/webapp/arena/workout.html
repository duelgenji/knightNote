<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title></title>
    <link href="static/semantic/semantic.css" rel="stylesheet"/>

    <style>

        body {
            font-size: 12px;
        }
        .container{
            padding: 20px 0;
            max-width: 768px;
            margin: 0 auto;
        }

        .menus{
            width: 100%;
            position: relative;
        }

        .menu{
            margin-top: 10px;
            float: left;
            width: 50%;
            padding: 0 20px;
        }

        .menu .content{
            padding: 10px 0 5px 0;
        }


        .menu-wrap{
            padding: 10px;
            border-radius: .28571429rem;
            box-shadow: 0 1px 3px 0 #D4D4D5,0 0 0 1px #D4D4D5;
        }

        .button{
            padding: 8px !important;
        }

        .ui.ribbon.label {
            left: -28px;
            margin-right: -1.2em;
            padding-left: 20px;
            padding-right: 1.2em;
        }


        .extra{
            /*display: none;*/
        }


    </style>

</head>
<body>
<div id="sout"></div>
<div class="container">
    <div class="ui menus">
        <div class="menu" data-progression="0">
            <div class="menu-wrap">
                <a class="ui red ribbon label">俯卧撑</a>
                <div class="content">
                    <div class="meta">
                        上一次：
                    </div>
                    <div class="description">
                        　
                    </div>
                </div>

                <div class="extra">
                    <div class="ui two buttons">
                        <div class="ui red button">升级</div>
                        <div class="ui basic grey button">继续</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="menu" data-progression="1">
            <div class="menu-wrap">
                <a class="ui orange ribbon label">深蹲</a>
                <div class="content">
                    <div class="meta">
                        上一次：
                    </div>
                    <div class="description">
                        　
                    </div>
                </div>
                <div class="extra">
                    <div class="ui two buttons">
                        <div class="ui basic green button">升级</div>
                        <div class="ui basic red button">继续</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="menu" data-progression="2">
            <div class="menu-wrap">
                <a class="ui blue ribbon label">引体向上</a>
                <div class="content">
                    <div class="meta">
                        上一次：
                    </div>
                    <div class="description">
                        　
                    </div>
                </div>
                <div class="extra">
                    <div class="ui two buttons">
                        <div class="ui basic green button">升级</div>
                        <div class="ui basic red button">继续</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="menu" data-progression="3">
            <div class="menu-wrap">
                <a class="ui teal ribbon label">举腿</a>
                <div class="content">

                    <div class="meta">
                        上一次：
                    </div>
                    <div class="description">
                        　
                    </div>
                </div>
                <div class="extra">
                    <div class="ui two buttons">
                        <div class="ui basic green button">升级</div>
                        <div class="ui basic red button">继续</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="menu" data-progression="4">
            <div class="menu-wrap">
                <a class="ui violet ribbon label">桥</a>
                <div class="content">

                    <div class="meta">
                        上一次：
                    </div>
                    <div class="description">
                        　
                    </div>
                </div>
                <div class="extra">
                    <div class="ui two buttons">
                        <div class="ui basic green button">升级</div>
                        <div class="ui basic red button">继续</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="menu" data-progression="5">
            <div class="menu-wrap">
                <a class="ui green ribbon label">倒立撑</a>
                <div class="content">

                    <div class="meta">
                        上一次：
                    </div>
                    <div class="description">
                        　
                    </div>
                </div>
                <div class="extra">
                    <div class="ui two buttons">
                        <div class="ui basic green button">升级</div>
                        <div class="ui basic red button">继续</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div style="text-align: center;">
        <button id="showImage" class="ui circular grey icon button">
            <i class="file image outline icon"></i>
        </button>
    </div>


    <div class="ui modal">
        <i class="close icon"></i>
        <div id="modal_header" class="header">

        </div>
        <div id="modal_content" class="content">
            <div class="ui vertical accordion menu">
                <div class="item"><a class="title"><i class="dropdown icon"></i>aaa</a>
                    <div class=" content">
                        <div class="ui form">
                            <div class="grouped fields">
                                <div class="field">
                                    <div class="ui radio checkbox">
                                        <input type="radio" name="size" value="small">
                                        <label>初级</label>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui radio checkbox">
                                        <input type="radio" name="size" value="small">
                                        <label>中级</label>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui radio checkbox">
                                        <input type="radio" name="size" value="small">
                                        <label>高级</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

    </div>
</div>



</body>
<script src="../static/knight/js/jquery-2.1.4.min.js"></script>
<script src="../static/semantic/semantic.js"></script>
<script src="../static/knight/js/basic.js"></script>

<script>
    var aProgression = ["俯卧撑","深蹲","引体向上","举腿","桥","倒立撑"];
    var aLevel = ["自定义","初级标准","中级标准","高级标准"];
    var aList = [];

    var aShi = ["","一","二","三","四","五","六","七","八","九","十"];
    var aJi = ["","初","中","高"];
    var aXq = ["","周一","周二","周三","周四","周五","周六","周日"];

    $(document).ready(function(){
//        $("#sout").html(navigator.userAgent);

        $("#showImage").on("click",function(){
            window.open("http://cdn.zhixin.me/knight_progressions.jpg");
        });

        //加载 囚徒健身列表
        $.get("static/knight/js/convictCondition.txt",function(data){
            var list = data.split("#");
            for(var i in list){
                var t = list[i].split("\n");
                t.pop();
                aList.push(t);
            }
        });
        $(".menus .menu").on("click",function(){
            updateAccordion($(this).data("progression"));
            $(".ui.modal").modal("show");

        });

        //label input checkbox 点击也有效
        $(document).on("click",".checkbox label",function(){
            $(this).parent().find("input").click();
        });

        $(document).on("click","#done",function(){
            var $dom = $("input[name='level']:checked");

            if($dom.length<1){
                alert("选择一项啦");
                return;
            }

            var json = {};

            json.progression = $dom.data("progression");
            json.step = $dom.data("step");
            json.level = $dom.data("level");
            var value = $dom.val();
            var countType = 0;
            var count = 0 ;
            var countGroup = 1 ;
            if(!value.match("x")){
                countType = 1;
                countGroup = 1;
                count = parseInt(value);
            }else{
                countType = 0;
                countGroup = parseInt(value.split("x")[0]);
                count = parseInt(value.split("x")[1]);
            }
            json.countType = countType;
            json.count = count;
            json.countGroup = countGroup;

            postRequest("/regular/generateConvictCondition",json,function(result){
//                console.log(result);
                if(result.success){
                   alert("成功");
                }else{
                }
            });
        });


        postRequest("/regular/retrieveLast",null,function(result){
            if(result.success==1){
                /** @namespace result.convictConditionList */
                var ccList = result.convictConditionList;
                var progression,step,level,lastTimeText,lastDate,date;
                for(var i = 0 ; i<ccList.length;i++){
                    progression = ccList[i].progression;
                    step = ccList[i].step;
                    level = ccList[i].level;
                    date = ccList[i].createdDate;

                    lastDate = new Date(date);
                    lastTimeText =(lastDate.getMonth()+1) + "月" + lastDate.getDate() + "日 " + aXq[new Date(date).getDay()];

                    var $2 = $(".menu[data-progression='" + progression + "']");
                    $2.find(".meta").append(""+lastTimeText+"");
                    $2.find(".description").html(aShi[step]+"式—"+aList[progression][step].split(" ")[0]+" "+aJi[level]+"级");

                }

            }
//            console.log(result);
        });


    });

    function updateAccordion(index){

        $("#modal_header").html(aProgression[index]);

        var fieldHtml = '<div class="field"><div class="ui radio checkbox"><input type="radio" name="size" value="small"><label>Small</label></div></div>';

        var progression = aList[index];

        var itemHtml = '';

        var aDetail;


        for(var i = 0;i< progression.length;i++){

            aDetail = progression[i].split(" ");
            console.log(aDetail);
            fieldHtml = '';
            for(var j = 1;j<aDetail.length;j++){
                fieldHtml += '<div class="field"><div class="ui radio checkbox"><input type="radio" name="level" data-progression="'+index+'" data-step="'+(i+1)+'" data-level="'+j+'" value="'+aDetail[j]+'"><label>'+aLevel[j]+aDetail[j]+'</label></div></div>'
            }

            itemHtml+= '<div class="item"><a class="title"><i class="dropdown icon"></i>'+aDetail[0]+'</a><div class="content"><div class="ui form"><div class="grouped fields">'+fieldHtml+'</div></div></div></div>';

        }

        var buttonHtml = '<div style="clear:both;"><button id="done" class="ui green button">完成</button></div>';

        var accordionHtml = '<div class="ui vertical accordion menu" style="margin-bottom: 20px">'+itemHtml+'</div>'+buttonHtml;

        $('#modal_content').empty().append(accordionHtml);

        $(".ui.accordion").accordion();


    }
</script>
</html>